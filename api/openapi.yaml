openapi: 3.0.3
info:
  title: jphacks2020_f_2002
  version: 0.0.0
servers:
  - url: https://e3c902a3-9f7d-4f1c-9b9a-daa5e4633165.mock.pstmn.io
    description: モックサーバー
  - url: localhost:8080
    description: ローカル環境
tags:
  - name: admin
    description: 管理者ユーザー用
  - name: general
    description: 一般ユーザー用
  - name: user
  - name: plant
  - name: cultivation
  - name: message

paths:
  /users:
    get:
      tags:
        - admin
        - user
      summary: 全ユーザーを取得
      security:
        - Admin: []
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
    post:
      tags:
        - admin
        - general
        - user
      summary: ユーザーを登録
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 255
                  example: 御謝部　次多振
                email:
                  type: string
                  format: email
                  maxLength: 255
                  example: user@example.com
              required:
                - name
                - email
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /users/{user_id}:
    get:
      tags:
        - admin
        - user
      security:
        - Admin: []
      summary: 特定のユーザーを取得
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Id'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        404:
          $ref: '#/components/responses/404'

    put:
      tags:
        - admin
        - user
      security:
        - Admin: []
      summary: 特定のユーザーを更新
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 255
                  example: 御謝部　次多振
                email:
                  type: string
                  format: email
                  maxLength: 255
                  example: user@example.com
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        404:
          $ref: '#/components/responses/404'

    delete:
      tags:
        - admin
        - user
      summary: 特定のユーザーを論理削除
      security:
        - Admin: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Id'
      responses:
        204:
          $ref: '#/components/responses/204'
        404:
          $ref: '#/components/responses/404'

  /user:
    get:
      tags:
        - general
        - user
      summary: ログイン中のユーザーを取得
      security:
        - Firebase: []
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

    put:
      tags:
        - general
        - user
      summary: ログイン中のユーザーを変更
      security:
        - Firebase: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 255
                  example: 御謝部　次多振
                email:
                  type: string
                  format: email
                  maxLength: 255
                  example: user@example.com
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        404:
          $ref: '#/components/responses/404'

    delete:
      tags:
        - general
        - user
      summary: ログイン中のユーザーを論理削除
      security:
        - Firebase: []
      responses:
        204:
          $ref: '#/components/responses/204'
        404:
          $ref: '#/components/responses/404'

  /plants:
    get:
      tags:
        - admin
        - general
        - plant
      summary: 全植物を取得
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Plant'

    post:
      tags:
        - admin
        - plant
      summary: 植物を登録
      security:
        - Admin: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: 朝顔
                description:
                  type: string
                  example: 朝に咲く
                thumbnail:
                  $ref: '#/components/schemas/URL'
                water:
                  type: number
                  format: float
                  description: 未定
                season:
                  type: object
                  properties:
                    from:
                      description: 月
                      type: integer
                      example: 4
                    to:
                      description: 月
                      type: integer
                      example: 6
                temperature:
                  type: object
                  properties:
                    from:
                      type: number
                      format: float
                      example: 20.5
                    to:
                      type: number
                      format: float
                      example: 29.5
              required:
                - name
                - description
                - thumbnail
                - water
                - season
                - temperature
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /plants/{plant_id}:
    get:
      tags:
        - admin
        - general
        - plant
      summary: 特定の植物を取得
      parameters:
        - name: plant_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Id'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Plant'
        404:
          $ref: '#/components/responses/404'

    put:
      tags:
        - admin
        - plant
      summary: 徳栄値の植物を更新
      parameters:
        - name: plant_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Id'
      security:
        - Admin: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: 朝顔
                description:
                  type: string
                  example: 朝に咲く
                thumbnail:
                  $ref: '#/components/schemas/URL'
                water:
                  type: number
                  format: float
                  description: 未定
                season:
                  type: array
                  items:
                    type: integer
                    description: 月
                    example: 4
                temperature:
                  type: object
                  properties:
                    from:
                      type: number
                      format: float
                      example: 20.5
                    to:
                      type: number
                      format: float
                      example: 29.5
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Plant'
        404:
          $ref: '#/components/responses/404'

    delete:
      tags:
        - plant
      summary: 特定の植物を論理削除
      security:
        - Admin: []
      parameters:
        - name: plant_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Id'
      responses:
        204:
          $ref: '#/components/responses/204'
        404:
          $ref: '#/components/responses/404'

  /user/cultivations/{cultivation_id}:
    get:
      tags:
        - general
        - cultivation
      summary: ログイン中のユーザーの特定の栽培物を取得
      security:
        - Firebase: []
      parameters:
        - name: cultivation_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Id'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cultivation'

    delete:
      tags:
        - general
        - cultivation
      summary: ログイン中のユーザーの特定の栽培物を論理削除
      security:
        - Firebase: []
      parameters:
        - name: cultivation_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Id'
      responses:
        204:
          $ref: '#/components/responses/204'
        404:
          $ref: '#/components/responses/404'

  /user/cultivations/{cultivation_id}/watering:
    post:
      tags:
        - general
        - cultivation
      summary: ログイン中のユーザーの特定の栽培物に水やり
      security:
        - Firebase: []
      parameters:
        - name: cultivation_id
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/Id'
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Watering'

  /messages:
    get:
      tags:
        - message
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Message'

    post:
      tags:
        - message
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                text:
                  type: string
                  example: 水が欲しいな♪
              required:
                - text
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'

  /admin/reset:
    get:
      tags:
        - admin
      summary: 'DBを初期化し、初期データを挿入'
      security:
        - Admin: []
      responses:
        204:
          $ref: '#/components/responses/204'

components:
  schemas:
    Id:
      type: integer
      minimum: 1
      example: 1

    Time:
      type: string
      format: HH:MM:SS
      example: '12:59:59'

    Datetime:
      type: string
      format: date-time
      example: 2020-01-01T12:59:59Z

    Count:
      type: integer
      minimum: 0
      example: 10

    URL:
      type: string
      format: url
      example: 'https://example.com'

    User:
      description: ユーザー
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Id'
        ccreated_at:
          $ref: '#/components/schemas/Datetime'
        updated_at:
          $ref: '#/components/schemas/Datetime'
        deleted_at:
          $ref: '#/components/schemas/Datetime'
        uid:
          description: firebaseのuid
          type: string
          example: DFXSgRVbVKjBdAnYxN6wCZx74UNsDf3
        name:
          type: string
          example: 御謝部　次多振
        email:
          type: string
          format: email
          example: user@example.com
        cultivation:
          type: array
          items:
            type: object
            properties:
              id:
                $ref: '#/components/schemas/Id'
              plant:
                $ref: '#/components/schemas/Plant'
              purchase_date:
                $ref: '#/components/schemas/Datetime'
              start_date:
                $ref: '#/components/schemas/Datetime'

    Temperature:
      description: 気温
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Id'
        name:
          type: string
          example: 暑い
        value:
          type: number
          format: float
          example: 29.5

    Water:
      description: 水分量
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Id'
        name:
          type: string
          example: 多い
        value:
          description: 値が小さいほど水分が多い
          type: integer
          example: 464

    Plant:
      description: 植物
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Id'
        created_at:
          $ref: '#/components/schemas/Datetime'
        updated_at:
          $ref: '#/components/schemas/Datetime'
        deleted_at:
          $ref: '#/components/schemas/Datetime'
        name:
          type: string
          example: じゃがいも
        nick_name:
          type: string
          example: じゃがーくん
        price:
          description: 円
          type: integer
          minimum: 0
          example: 880
        period:
          description: 栽培期間（日）
          type: integer
          minimum: 0
          example: 90
        difficulty:
          description: 難易度（１〜？）
          type: integer
          minimum: 1
          # maximum: ?
          example: 2
        description:
          type: string
          example: おいしさ満点のジャガイモだよ！ほくほく
        kit_name:
          type: string
          example: 始めてでも安心ジャガイモキット
        season:
          description: 適正時期
          type: object
          properties:
            from:
              description: 月
              type: integer
              example: 4
            to:
              description: 月
              type: integer
              example: 6
        temperatures:
          description: 温度環境
          type: array
          items:
            $ref: '#/components/schemas/Temperature'
        waters:
          description: 水分環境
          type: array
          items:
            $ref: '#/components/schemas/Water'

    Watering:
      description: 水やりの記録
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Id'
        created_at:
          $ref: '#/components/schemas/Datetime'
        updated_at:
          $ref: '#/components/schemas/Datetime'
        deleted_at:
          $ref: '#/components/schemas/Datetime'

    Cultivation:
      description: 栽培している植物
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Id'
        created_at:
          $ref: '#/components/schemas/Datetime'
        updated_at:
          $ref: '#/components/schemas/Datetime'
        deleted_at:
          $ref: '#/components/schemas/Datetime'
        plant:
          $ref: '#/components/schemas/Plant'
        purchase_date:
          $ref: '#/components/schemas/Datetime'
        start_date:
          $ref: '#/components/schemas/Datetime'
        watering:
          type: array
          items:
            $ref: '#/components/schemas/Watering'

    Message:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/Id'
        created_at:
          $ref: '#/components/schemas/Datetime'
        updated_at:
          $ref: '#/components/schemas/Datetime'
        deleted_at:
          $ref: '#/components/schemas/Datetime'
        speaker:
          type: string
          description: user | plant
          example: plant
        text:
          type: string
          example: 水が欲しいな♪

  responses:
    200:
      description: OK
    201:
      description: Created
    204:
      description: No Content
    400:
      description: Bad Request
    401:
      description: Unauthorized
    403:
      description: ForbIdden
    404:
      description: Not Found
    cors:
      description: Default response for CORS method
      headers:
        Access-Control-Allow-Headers:
          schema:
            type: 'string'
        Access-Control-Allow-Methods:
          schema:
            type: 'string'
        Access-Control-Allow-Origin:
          schema:
            type: 'string'

  securitySchemes:
    Admin:
      type: apiKey
      name: Authorization
      in: header
      description: IDトークンを付与

    Firebase:
      type: apiKey
      name: Authorization
      in: header
      description: IDトークンを付与
